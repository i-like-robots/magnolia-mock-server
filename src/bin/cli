#!/usr/bin/env node

const commander = require("commander");
const path = require("path");
const bootstrap = require("../bootstrap");

function parseNumber(value) {
  const number = parseInt(value, 10);

  if (isNaN(number)) {
    throw new commander.InvalidArgumentError("Not a number.");
  }

  return number;
}

commander
  .option(
    "-p, --port <number>",
    "Port number to run the mock server on",
    parseNumber,
    5000
  )
  .option(
    "-d, --depth <number>",
    "How deep the node tree will be traversed",
    parseNumber,
    0
  )
  .argument("[dir]", "Path to the directory containing your YAML files")
  .action((dir, options) => {
    if (dir) {
      try {
        const sourceDir = path.resolve(dir);
        bootstrap({ ...options, sourceDir });
      } catch (err) {
        console.error(err);
        process.exit(1);
      }
    } else {
      console.error(`No directory defined.\nSee 'magnolia-mock-server --help'`);
      process.exit(1);
    }
  });

commander.parse(process.argv);
